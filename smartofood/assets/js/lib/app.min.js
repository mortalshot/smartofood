define("app",["jquery","swal","jui","mask"],function(e,n){"use strict";return function(t){var o=e("body"),i=null,a=null,s=null,d=null,r={email:/^([a-zа-я0-9_\.-])+@[a-zа-я0-9-]+\.([a-zа-я]{2,6}\.)?[a-zа-я]{2,6}$/iu,phone:/^\+7\s[\d]{3}\s[\d]{3}\-[\d]{2}\-[\d]{2}$/,string:/^[a-zа-я0-9\s_,%\(\)\-\.]+$/iu,number:/^[\d]+$/,json:/^(\{.+\}|\[.+\])$/iu,date:/^(0?[1-9]|[12]\d|3[01])[\.](0?[1-9]|1[0-2])[\.](19|20)\d{2}$/,any:/^.+$/iu},l={debug:"prod"!==appEnv,skipAjaxErrors:!1,imagePlug:appCdn+"/assets/images/plug-dish.svg",currencySymbol:"₽",currencyDecimals:0,thousandSeparator:" ",decimalSeparator:","};if(void 0!==t)for(var c in t)c in l&&(l[c]=t[c]);var u=function(e,n){if("string"==typeof e)return e;if("number"==typeof e)return e.toString();if("object"!=typeof e)return"";void 0===n&&(n=1);for(var t="",o="",i=0;i<n;i++)t+=" ";return o+="{\n",Object.entries(e).forEach(([e,i])=>{switch(o+=t+"'"+e+"': ",typeof i){case"object":o+=u(i,n+1);break;case"string":o+="'"+i+"'";break;case"number":o+=i;break;default:o+=""}o+="\n"}),o+t+"}"},p=function(e){return JSON.parse(JSON.stringify(e))},f=function(e,n,t){if(void 0===e||void 0===n)return"";void 0===t&&(t=!0);var o=0;return(o=e%100)>=5&&o<=20?(t?e.toString()+" ":"")+n[2]:1==(o%=10)?(t?e.toString()+" ":"")+n[0]:o>=2&&o<=4?(t?e.toString()+" ":"")+n[1]:(t?e.toString()+" ":"")+n[2]},h=function(e,n,t,o){var i,a;return isNaN(n=Math.abs(n))&&(n=2),null==t&&(t=","),null==o&&(o="."),(a=(i=parseInt(e=(+e||0).toFixed(n))+"").length)>3?a%=3:a=0,(a?i.substr(0,a)+o:"")+i.substr(a).replace(/(\d{3})(?=\d)/g,"$1"+o)+(n?t+Math.abs(e-i).toFixed(n).replace(/-/,0).slice(2):"")},m=function(){return null===a&&(a="string"!=typeof(a=o.attr("data-shop"))||0==a.length?0:+a),a},g=function(){return null===s&&("string"==typeof(s=o.attr("data-shop-prompt"))&&0!=s.length||(s="off")),s},v=function(){return null===d&&("string"==typeof(d=o.attr("data-xhr"))&&0!=d.length||(d=null)),d},w=function(){return null===i&&(i="string"!=typeof(i=o.attr("data-guest"))||0==i.length?0:+i),i>0},b=function(e){var n=o.attr("data-ym");if("string"!=typeof e||"object"!=typeof{CALLBACK_WINDOW_OPENED:{category:"Обратный звонок",action:"Открыто окно обратного звонка"},CALLBACK_SEND:{category:"Обратный звонок",action:"Отправлен номер телефона для обратного звонка"},AUTH_WINDOW_OPENED:{category:"Авторизация",action:"Открыто окно авторизации"},AUTH_SEND:{category:"Авторизация",action:"Отправлен пин-код для авторизации"},AUTH_RESEND:{category:"Авторизация",action:"Повторно отправлен пин-код для авторизации"},AUTH_CONFIRMED:{category:"Авторизация",action:"Телефон подтвержден"},CART_ADD:{category:"Корзина",action:"Добавлен продукт в корзину"}}[e])return!1;try{ym(n,"reachGoal",e)}catch(e){console.log(e)}try{gtag("event",e)}catch(e){console.log(e)}},C=function(e){try{ym(o.attr("data-ym"),"hit",e)}catch(e){console.log(e)}},y=function(){let e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)},_=function(e){"boolean"!=typeof e&&(e=!0),e?!W.windowOpened&&o.hasClass("noscroll")&&o.removeClass("noscroll"):o.hasClass("noscroll")||o.addClass("noscroll"),y()},k=function(e){S()&&("boolean"!=typeof e&&(e=!1),e?o.hasClass("freeze")||o.addClass("freeze"):!W.windowOpened&&o.hasClass("freeze")&&o.removeClass("freeze"),y())},S=function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},B={init:function(){"off"!=g()&&(B.window=e("#shops-window"),B.windowOpened=!1,0!=B.window.length&&(e(".header_city.c-pointer").on("click",function(){B.scroller=e(this).closest(".hidescroll"),B.windowOpened?B.closeWindow():B.openWindowInit()}),B.window.find(".close-cross").on("click",function(){B.closeWindow()}),0===m()&&B.openWindowInit()))},openWindowInit:function(){var e;"shop-geo"==g()?"function"==typeof(e=B.loadShops)&&(navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){e(n.coords)},function(n){l.debug&&console.warn(`ERROR(${n.code}): ${n.message}`),e()},{enableHighAccuracy:!0,timeout:3e3,maximumAge:0}):e()):B.loadShops()},onBodyClick:function(e){var n=B.window.find(".window_panel");B.windowOpened&&(n.is(e.target)||0!==n.has(e.target).length||B.closeWindow()),B.firstEvent=!0},drawResults:function(n){if("object"==typeof n){var t="",o=!0;for(var i in g(),n){var a=n[i];for(var s in t+='<div class="sws_block">',t+='<div class="sws_title"><div class="text">'+a[0].city+"</div></div>",t+='<div class="sws_list">',a){var d=a[s],r=d.selected,l="number"==typeof d.distance;t+='<div class="sws_shop'+(r?" selected":"")+'"'+(o&&l?' title="Ближайшее заведение"':"")+' data-id="'+d.id+'">',t+='<div class="swss_name">'+d.name+"</div>",t+='<div class="swss_addr">'+d.street+", "+d.house+"</div>",t+='<div class="swss_wrapper"></div>',t+='<div class="swss_time">'+(d.is_open?d.working_time:"Закрыто")+"</div>",t+="</div>",o=!1}t+="</div></div>"}B.window.find(".shops_window .sw_shops").html(t).find(".sws_shop:not(.selected)").on("click",function(){"string"==typeof e(this).attr("data-id")&&(window.location="/profile/shop?id="+e(this).attr("data-id"))})}},loadShops:function(n){var t={id:m(),xhr:v()};void 0!==n&&(t.lat=n.latitude,t.lon=n.longitude),e.ajax("/profile/pickup-shops",{cache:!1,dataType:"json",type:"POST",data:t,success:function(e){if(void 0===e)return!1;B.drawResults(e),B.openWindow()},error:function(e){l.debug&&console.log(e.responseJSON)}})},openWindow:function(){O.opened&&O.close(!0),B.scrollTop=O.opened?O.scrollTop:e(window).scrollTop(),B.firstEvent=!1,_(!1),o.on("click",B.onBodyClick),B.window.addClass("opened").animate({opacity:1},100,function(){k(!0)}),B.windowOpened=!0},closeWindow:function(n){void 0===n&&(n=!1),n?B.window.css({opacity:0}).removeClass("opened"):B.window.animate({opacity:0},100,function(){e(this).removeClass("opened")}),B.windowOpened=!1,o.off("click",B.onBodyClick),k(!1),_(!0),e(window).scrollTop(B.scrollTop)}},P={init:function(){"off"===g()&&(P.window=e("#city-window"),P.input=P.window.find(".cw_search"),P.result=P.window.find(".cw_result"),P.cities=[],P.menu=e("#city-dropdown"),P.windowOpened=!1,P.menuOpened=!1,e(".header_city.c-pointer").on("click",function(){P.totalCities=parseInt(e(this).attr("data-cities")),P.initiator=e(this),P.scroller=e(this).closest(".hidescroll"),P.totalCities<10?P.menuOpened?P.closeMenu():P.openMenu():P.windowOpened?P.closeWindow():P.openWindow()}),P.window.find(".close-cross").on("click",function(){P.closeWindow()}))},onBodyClick:function(e){var n=P.window.find(".window_panel");P.menuOpened&&P.firstEvent&&!P.menu.is(e.target)&&0===P.menu.has(e.target).length&&P.closeMenu(),P.windowOpened&&P.firstEvent&&!n.is(e.target)&&0===n.has(e.target).length&&P.closeWindow(),P.firstEvent=!0},onWindowResize:function(){P.menuOpened&&P.closeMenu(!0)},drawWindowResults:function(e){if("object"==typeof e){var n="";for(var t in e){var o=e[t];for(var i in n+='<div class="cwr_group">',n+='<div class="cwr_letter">'+t+"</div>",o){var a=o[i];a.selected?n+='<div class="cwr_item selected">'+a.name+"</div>":n+='<a class="cwr_item" href="/profile/city?id='+a.id+'">'+a.name+"</a>"}n+="</div>"}P.result.html(n)}},searchCities:function(e){e="string"!=typeof e?"":e.toLowerCase();var n=[];for(var t in P.cities){var o=P.cities[t],i=o.name.toLowerCase(),a=i[0].toUpperCase();(0===e.length||i.indexOf(e)>-1)&&(void 0===n[a]&&(n[a]=[]),n[a].push(o))}return n},onInputChange:function(){P.drawWindowResults(P.searchCities(e(this).val()))},openWindow:function(){void 0!==P.initiator&&(O.opened&&O.close(!0),P.cities=JSON.parse(P.result.attr("data-cities")),P.scrollTop=O.opened?O.scrollTop:e(window).scrollTop(),P.firstEvent=!1,_(!1),o.on("click",P.onBodyClick),new Promise(function(e,n){P.input.on("keyup",P.onInputChange).trigger("keyup")}),P.window.addClass("opened").animate({opacity:1},100,function(){P.input.focus(),k(!0)}),P.windowOpened=!0)},closeWindow:function(n){void 0===n&&(n=!1),n?P.window.css({opacity:0}).removeClass("opened"):P.window.animate({opacity:0},100,function(){e(this).removeClass("opened"),P.result.html(""),P.input.val("")}),P.windowOpened=!1,P.input.off("keyup"),o.off("click",P.onBodyClick),k(!1),_(!0),e(window).scrollTop(P.scrollTop)},openMenu:function(){if(void 0!==P.initiator){var n=P.initiator.offset().top+P.initiator.outerHeight()+8-e(window).scrollTop(),t=P.initiator.offset().left,i=P.initiator.outerWidth(),a=n+P.menu.outerHeight()>e(window).height();P.firstEvent=!1,o.on("click",P.onBodyClick),e(window).resize(P.onWindowResize),P.scroller.on("scroll",P.onWindowResize),P.menu.css({top:n,left:t,bottom:a?20:"auto",width:i}).addClass("overflow-scroll-y").addClass("hidescroll"),P.menu.addClass("opened").animate({opacity:1},100),P.menuOpened=!0}},closeMenu:function(n){void 0===n&&(n=!1),P.menu.css({bottom:"auto"}).removeClass("overflow-scroll-y").removeClass("hidescroll"),n?P.menu.css({opacity:0}).removeClass("opened"):P.menu.animate({opacity:0},100,function(){e(this).removeClass("opened")}),P.menuOpened=!1,o.off("click",P.onBodyClick),e(window).off("resize",P.onWindowResize),P.scroller.off("scroll",P.onWindowResize)}},O={init:function(){O.nav=e("#navigation"),O.bodyNav=e(".body_nav .nav_menu"),O.headerNav=e(".header_nav .hm_wrapper"),O.header=e(".header"),O.hamburger=O.header.find(".header_hamburger"),O.opened=!1,O.scrollTop=0,0!=O.nav.length&&0!=O.header.length&&0!=O.hamburger.length&&(O.hamburger.on("click",function(){O.open()}),O.nav.find(".close-block").on("click",function(){O.close()}),O.bodyNav.length>0&&(e(window).on("resize",O.navAutoHeight).on("scroll",O.navAutoHeight),O.navAutoHeight()),O.headerNav.length>0&&O.headerNavPositioning())},headerNavPositioning:function(){var n=O.headerNav.find(".selected");if(0==n.length)return!1;var t=n.parent(),o=t.width(),i=n.position(),a=n.outerWidth(!0),s=i.left+a,d=0;(i.left<0||s>o)&&(t.find(".hm_item").each(function(){if(e(this).hasClass("selected"))return!1;d+=e(this).outerWidth(!0)}),t.animate({scrollLeft:d-(o/2-a/2)},100))},navAutoHeight:function(){var n,t,o,i,a,s,d,r,l,c,u,p,f,h=parseInt(e(".body").css("margin-top")),m=e(window).height(),g=e(".footer").outerHeight(),v=O.bodyNav.height("auto").outerHeight(),w=m-O.header.outerHeight()-2*h,b=w-20,C={left:0,top:0},y=(n=".body_nav .nav_menu",t=".footer",o=C,i=document.querySelector(n),a=window.pageYOffset+i.getBoundingClientRect().top,s=window.pageXOffset+i.getBoundingClientRect().left,d=window.pageXOffset+i.getBoundingClientRect().right,r=window.pageYOffset+i.getBoundingClientRect().bottom,l=document.querySelector(t),c=window.pageYOffset+l.getBoundingClientRect().top,u=window.pageXOffset+l.getBoundingClientRect().left,p=window.pageXOffset+l.getBoundingClientRect().right,f=window.pageYOffset+l.getBoundingClientRect().bottom,r>c&&a<f&&d>u&&s<p&&("object"==typeof o&&(o.top=r-c,o.left=s-u),!0));m>3*g&&y?O.bodyNav.height(v-C.top-2*h):w>v?O.bodyNav.height("auto"):O.bodyNav.height(b)},onBodyClick:function(e){var n=O.nav.find(".nav_panel");!O.firstEvent||P.menu.is(e.target)||0!==P.menu.has(e.target).length||n.is(e.target)||0!==n.has(e.target).length||O.close(),O.firstEvent=!0},open:function(){O.scrollTop=e(window).scrollTop(),O.firstEvent=!1,o.on("click",O.onBodyClick),_(!1),O.nav.addClass("opened").animate({opacity:1},100,function(){O.hamburger.addClass("opened"),O.opened=!0,k(!0)})},close:function(n){void 0===n&&(n=!1),n?O.nav.css({opacity:0}).removeClass("opened"):O.nav.animate({opacity:0},100,function(){e(this).removeClass("opened")}),P.menuOpened&&P.closeMenu(n),O.hamburger.removeClass("opened"),O.opened=!1,o.off("click",O.onBodyClick),k(!1),_(!0),e(window).scrollTop(O.scrollTop)}},T={init:function(){T.window=e("#callback-window"),T.input=T.window.find("input").mask("+7 000 000-00-00"),T.submit=T.window.find(".btn"),T.opened=!1,T.sending=!1,0!=T.window.length&&0!=T.input.length&&0!=T.submit.length&&(e(".footer_phone .phone:not(.offservice), .header_phone:not(.offservice)").on("click",function(){T.initiator=e(this),T.opened?T.close():T.open()}),T.window.find(".close-cross").on("click",function(){T.close()}))},onBodyClick:function(n){var t=T.window.find(".window_panel"),o=e(".swal2-container");!T.firstEvent||o.is(n.target)||0!==o.has(n.target).length||t.is(n.target)||0!==t.has(n.target).length||T.close(),T.firstEvent=!0},onInputChange:function(){r.phone.test(T.input.val())?T.submit.removeClass("disabled"):T.submit.addClass("disabled")},send:function(){if(T.submit.hasClass("disabled")||T.sending)return!1;e.ajax("/profile/callback/send",{cache:!1,dataType:"json",type:"POST",data:{phone:T.input.val().replace(/[^\d]+/g,""),xhr:v()},beforeSend:function(){T.sending=!0,T.input.prop("disabled",!0),T.submit.addClass("disabled")},success:function(){T.window.find(".callback").addClass("d-none"),T.window.find(".callback-success").removeClass("d-none"),b("CALLBACK_SEND")},error:function(e){if(l.debug&&console.log(e.responseJSON),l.skipAjaxErrors)return this.success(),!0;void 0!==e.responseJSON&&403==e.status?n.fire({type:"warning",text:void 0!==e.responseJSON?e.responseJSON.error:null,confirmButtonClass:"btn btn-color",buttonsStyling:!1}):n.fire({type:"error",title:"Ошибка",text:"Произошла ошибка во время отправки сообщения. Попробуйте позже",confirmButtonClass:"btn btn-color",buttonsStyling:!1})},complete:function(){T.input.prop("disabled",!1),T.submit.removeClass("disabled"),T.sending=!1}})},open:function(){void 0!==T.initiator&&(O.opened&&O.close(!0),T.scrollTop=O.opened?O.scrollTop:e(window).scrollTop(),T.firstEvent=!1,_(!1),o.on("click",T.onBodyClick),T.input.on("keyup",T.onInputChange).on("keypress",function(e){13==e.keyCode&&T.send()}),T.submit.addClass("disabled").on("click",T.send),T.window.addClass("opened").animate({opacity:1},100,function(){T.input.focus(),k(!0)}),T.opened=!0,b("CALLBACK_WINDOW_OPENED"))},close:function(){T.sending||(T.window.animate({opacity:0},100,function(){e(this).removeClass("opened"),T.window.find(".callback").removeClass("d-none"),T.window.find(".callback-success").addClass("d-none"),T.submit.removeClass("disabled").off("click"),T.input.val("")}),T.opened=!1,T.input.off("keyup").off("keypress"),o.off("click",T.onBodyClick),k(!1),_(!0),e(window).scrollTop(T.scrollTop))}},N={init:function(){N.changePhone=!1,N.window=e("#auth-window"),N.isCall=N.window.hasClass("sms_call"),N.phoneInput=N.window.find(".signin input").mask("+7 000 000-00-00"),N.codeInput=N.window.find(".pincode .code-input").mask("0000"),N.codeFail=N.window.find(".pincode .code-fail"),N.codePanel=N.window.find(".pincode .code-panel"),N.codeDigits=N.codePanel.find(".digit"),N.sendBtn=N.window.find(".btn"),N.resendBtn=N.window.find(".pincode .resend"),N.wrongBtn=N.window.find(".pincode .wrong-number"),N.windowOpened=!1,N.sending=!1,N.resendTimestamp=-1,N.resendInterval=null,0!=N.window.length&&0!=N.phoneInput.length&&0!=N.codeInput.length&&0!=N.sendBtn.length&&0!=N.resendBtn.length&&0!=N.wrongBtn.length&&(e(".header_user, .navigation_user").on("click",function(){if(e(this).hasClass("active")||e(this).hasClass("disabled"))return!1;N.initiator=e(this),w()?window.location="/profile":N.windowOpened?N.closeWindow():N.openWindow()}),N.window.find(".close-cross").on("click",function(){N.closeWindow()}))},onBodyClick:function(n){var t=N.window.find(".window_panel"),o=e(".swal2-container");N.windowOpened&&(!N.firstEvent||o.is(n.target)||0!==o.has(n.target).length||t.is(n.target)||0!==t.has(n.target).length||N.closeWindow()),N.firstEvent=!0},onPhoneInputChange:function(){r.phone.test(N.phoneInput.val())?N.sendBtn.removeClass("disabled"):N.sendBtn.addClass("disabled")},onCodeInputsChange:function(){N.codeFail.html().length>0&&(N.codeFail.html(""),N.codeDigits.removeClass("invalid"));var n=e(this).val(),t=0;if(0==n.length)return N.codeDigits.html("").removeClass("invalid"),!0;N.codeDigits.html(""),N.codeDigits.each(function(){if(t>n.length-1)return!1;e(this).html(n.charAt(t)),t++}),4==n.length&&setTimeout(function(){N.confirmCode()},50)},onResendInterval:function(){var e=N.resendTimestamp-Date.now(),n=Math.round(e/1e3),t=N.resendBtn.find(".count");t.html("через "+f(n,["секунду","секунды","секунд"])),e<=1&&(clearInterval(N.resendInterval),t.html(""),N.resendBtn.removeClass("disabled"))},wrongNumber:function(){clearInterval(N.resendInterval),N.window.find(".pincode").addClass("d-none"),N.window.find(".signin").removeClass("d-none").find("input").focus()},sendCode:function(){if(N.sendBtn.hasClass("disabled")||N.sending)return!1;var t=N.changePhone?"/profile/phone/change":"/profile/login/send";e.ajax(t,{cache:!1,dataType:"json",type:"POST",data:{phone:N.phoneInput.val().replace(/[^\d]+/g,""),xhr:v()},beforeSend:function(){N.sending=!0,N.phoneInput.prop("disabled",!0),N.sendBtn.addClass("disabled")},success:function(){N.resendBtn.addClass("disabled").find(".count").html("через 60 секунд"),N.resendTimestamp=Date.now()+6e4,N.resendInterval=setInterval(N.onResendInterval,1e3),N.window.find(".signin").addClass("d-none"),N.window.find(".pincode").removeClass("d-none"),N.codeInput.val("").focus(),b("AUTH_SEND")},error:function(e){if(l.debug&&console.log(e.responseJSON),l.skipAjaxErrors)return this.success(),!0;void 0!==e.responseJSON&&403==e.status?n.fire({type:"warning",text:void 0!==e.responseJSON?e.responseJSON.error:null,confirmButtonClass:"btn btn-color",buttonsStyling:!1}):n.fire({type:"error",title:"Ошибка",text:"Произошла ошибка отправки пин-кода. Попробуйте позже",confirmButtonClass:"btn btn-color",buttonsStyling:!1})},complete:function(){N.sending=!1,N.phoneInput.prop("disabled",!1),N.sendBtn.removeClass("disabled")}})},resendCode:function(){if(N.resendBtn.hasClass("disabled")||N.sending)return!1;var t=N.changePhone?"/profile/phone/change":"/profile/login/send";e.ajax(t,{cache:!1,dataType:"json",type:"POST",data:{phone:N.phoneInput.val().replace(/[^\d]+/g,""),resend:1,xhr:v()},beforeSend:function(){N.sending=!0,N.codeInput.prop("disabled",!0).val(""),N.resendBtn.addClass("disabled")},success:function(){N.resendBtn.addClass("disabled").find(".count").html("через 60 секунд"),N.resendTimestamp=Date.now()+6e4,N.resendInterval=setInterval(N.onResendInterval,1e3),N.codeInput.focus(),b("AUTH_RESEND")},error:function(e){if(N.resendBtn.removeClass("disabled"),l.debug&&console.log(e.responseJSON),l.skipAjaxErrors)return this.success(),!0;void 0!==e.responseJSON&&403==e.status?n.fire({type:"warning",text:void 0!==e.responseJSON?e.responseJSON.error:null,confirmButtonClass:"btn btn-color",buttonsStyling:!1}):n.fire({type:"error",title:"Ошибка",text:"Произошла ошибка отправки пин-кода. Попробуйте позже",confirmButtonClass:"btn btn-color",buttonsStyling:!1})},complete:function(){N.sending=!1,N.codeInput.prop("disabled",!1).focus()}})},confirmCode:function(t){var o=N.codeInput.val();if(4!=o.length)return!1;var i=N.changePhone?"/profile/phone/change/confirm":"/profile/login";e.ajax(i,{cache:!1,dataType:"json",type:"POST",data:{phone:N.phoneInput.val().replace(/[^\d]+/g,""),code:o,xhr:v()},beforeSend:function(){N.sending=!0,N.codeInput.prop("disabled",!0),N.resendBtn.addClass("disabled"),N.codeFail.html("")},success:function(e){b("AUTH_CONFIRMED"),setTimeout(function(){"function"==typeof N.doneAuth?(N.sending=!1,N.closeWindow(),N.doneAuth(e)):window.location="/profile"},100)},error:function(e){0==N.resendBtn.find(".count").length&&N.resendBtn.removeClass("disabled"),N.codeInput.prop("disabled",!1).val("").focus(),N.codeDigits.html("").addClass("invalid"),401==e.status?N.codeFail.html("Неправильный пин-код"):n.fire({type:"error",title:"Ошибка",text:"Произошла ошибка авторизации. Попробуйте позже",confirmButtonClass:"btn btn-color",buttonsStyling:!1}),l.debug&&console.log(e.responseJSON)},complete:function(){N.sending=!1}})},openWindow:function(n){void 0!==N.initiator&&(N.scrollTop=O.opened?O.scrollTop:e(window).scrollTop(),N.firstEvent=!1,N.doneAuth=n,_(!1),o.on("click",N.onBodyClick),N.window.find(".pincode").on("click",function(){N.codeInput.focus()}),N.phoneInput.on("keyup",N.onPhoneInputChange).on("keypress",function(e){13==e.keyCode&&N.sendCode()}),N.codeInput.on("keyup",N.onCodeInputsChange).on("input",N.onCodeInputsChange),N.sendBtn.addClass("disabled").on("click",N.sendCode),N.resendBtn.addClass("disabled").on("click",N.resendCode),N.wrongBtn.on("click",N.wrongNumber),N.changePhone&&(N.window.find(".window_title span").html("Смена телефона"),N.window.find(".window_body .signin .message").html("ПИН-код для смены телефона будет "+(N.isCall?"передан в телефонном номере":"отправлен по&nbsp;СМС"))),N.window.addClass("opened").animate({opacity:1},100,function(){N.phoneInput.focus(),k(!0)}),N.windowOpened=!0,b("AUTH_WINDOW_OPENED"))},closeWindow:function(){N.sending||(N.window.animate({opacity:0},100,function(){e(this).removeClass("opened"),N.window.find(".signin").removeClass("d-none"),N.window.find(".pincode").addClass("d-none"),N.window.find(".window_title span").html("Вход на сайт"),N.window.find(".window_body .signin .message").html("ПИН-код для входа на&nbsp;сайт будет "+(N.isCall?"передан в телефонном номере":"отправлен по&nbsp;СМС")),N.sendBtn.removeClass("disabled").off("click"),N.resendBtn.removeClass("disabled").off("click"),N.phoneInput.val(""),N.codeInput.val(""),N.codeDigits.html("")}),N.windowOpened=!1,N.phoneInput.off("keyup").off("keypress"),N.window.find(".pincode").off("click"),N.codeInput.off("keyup").off("input"),N.wrongBtn.off("click"),N.codePanel.off("click"),o.off("click",N.onBodyClick),k(!1),_(!0),e(window).scrollTop(N.scrollTop))}},I={init:function(){I.sending=!1,I.changes={},I.name=e("#guest-name").on("keyup",I.onFormChange),I.phone=e("#guest-phone").mask("+7 000 000-00-00").on("click",I.changePhone),I.email=e("#guest-email").on("keyup",I.onFormChange),I.bday=e("#guest-day").on("selectmenuselect",I.onBDayChange),I.bmonth=e("#guest-month").on("selectmenuselect",I.onBDayChange),I.bchange=e("#guest-bchange"),I.isSubscribed=e("#guest-subs").on("click",function(){var n=e(this).find(".switcher");n.hasClass("checked")?n.removeClass("checked"):n.addClass("checked"),I.onFormChange()}),I.bonus=e("#guest-bonus"),I.saveBtn=e("#guest-save").on("click",I.save),I.orders=e(".profile-orders"),I.ordersList=I.orders.find(".po_list"),I.ordersLoad=I.orders.find(".po_load"),I.ordersMore=I.ordersLoad.find(".btn"),I.ordersMoreIcon=I.ordersMore.find(".btn_icon"),I.updateBonusBalance(),I.loadOrders()},onBDayChange:function(){I.bchange.attr("data-changed","1"),I.bday.selectmenu("widget").addClass("ui-valid"),I.bmonth.selectmenu("widget").addClass("ui-valid"),I.onFormChange()},onFormChange:function(){var e=!1,n=I.isSubscribed.find(".switcher"),t=n.hasClass("checked");I.name.val().length>0&&I.name.val()!=I.name.attr("data-last")?(I.changes.name=I.name.val(),I.name.addClass("valid"),e=!0):void 0!==I.changes.name&&(I.name.removeClass("valid"),delete I.changes.name),r.email.test(I.email.val())&&I.email.val()!=I.email.attr("data-last")?(I.changes.email=I.email.val(),I.email.addClass("valid"),e=!0):void 0!==I.changes.email&&(I.email.removeClass("valid"),delete I.changes.email),"1"==I.bchange.attr("data-changed")?(I.changes.bday=I.bmonth.val()+I.bday.val(),e=!0):void 0!==I.changes.bday&&delete I.changes.bday,+t!=parseInt(n.attr("data-last"))?(I.changes.is_subscribed=+t,e=!0):void 0!==I.changes.is_subscribed&&delete I.changes.is_subscribed,e?I.saveBtn.removeClass("d-none"):I.saveBtn.addClass("d-none")},save:function(){I.changes.xhr=v(),e.ajax("/profile/save",{cache:!1,dataType:"json",type:"POST",data:I.changes,beforeSend:function(){I.sending=!0,I.saveBtn.addClass("disabled").html('Сохраняю<div class="btn_icon load"></div>')},success:function(e){void 0!==I.changes.name&&I.name.attr("data-last",I.changes.name).removeClass("valid"),void 0!==I.changes.email&&I.email.attr("data-last",I.changes.email).removeClass("valid"),void 0!==I.changes.bday&&I.bchange.html(e.bday),void 0!==I.changes.is_subscribed&&I.isSubscribed.find(".switcher").attr("data-last",I.changes.is_subscribed),I.saveBtn.addClass("d-none"),I.changes={}},error:function(e){void 0!==e.responseJSON&&400==e.status?n.fire({type:"warning",text:void 0!==e.responseJSON?e.responseJSON.error:null,confirmButtonClass:"btn btn-color",buttonsStyling:!1}):n.fire({type:"error",title:"Ошибка",text:"Произошла ошибка сохранения. Попробуйте позже",confirmButtonClass:"btn btn-color",buttonsStyling:!1}),l.debug&&console.log(e.responseJSON)},complete:function(){I.sending=!1,I.saveBtn.removeClass("disabled").html("Сохранить")}})},changePhone:function(){N.changePhone=!0,N.initiator=I.phone,N.openWindow(function(){I.phone.val(N.phoneInput.val()),I.updateBonusBalance(),N.changePhone=!1})},updateBonusBalance:function(){e.ajax("/profile/bonus/balance",{cache:!1,dataType:"json",type:"POST",data:{xhr:v()},success:function(e){I.bonus.html(null!==e?Math.trunc(e):"&mdash;")},error:function(e){l.debug&&console.log(e.responseJSON)}})},loadOrders:function(){e.ajax("/profile/orders",{cache:!1,dataType:"json",type:"POST",data:{limit:4,page:I.orders.attr("data-page"),xhr:v()},beforeSend:function(){I.ordersMore.addClass("disabled"),I.ordersMoreIcon.removeClass("downarr").addClass("load")},success:function(n){var t="",o=!1;if(I.ordersLoad.addClass("d-none"),0===n.length)return!1;e.each(n,function(n,i){void 0===i.more?(t+='<div class="po_item">',t+='<div class="po_line">',t+='<div class="po_order c-pointer" data-link="/cart/success?id='+i.guid+'"><span>Заказ </span>#'+i.id+"</div>",t+='<div class="co_type clock">'+i.created_local+"</div>",t+="</div>",t+='<div class="po_line">',t+='<div class="po_name">Статус заказа:</div>',t+='<div class="order-status os_'+i.status+'">'+i.status_name+"</div>",t+="</div>",t+='<div class="po_line">',t+='<div class="po_name">Сумма к оплате:</div>',t+="<div>"+i.pay_sum+"</div>",t+="</div>",t+='<div class="po_line line"></div>',e.each(i.products,function(e,n){t+='<div class="po_line dish">',t+="<div>"+n.name+"</div>",t+='<div class="wrapper"></div>',t+='<div class="po_count">'+n.amount+" шт.</div>",t+='<div class="po_price">'+n.pay_sum+"</div>",t+="</div>"}),t+='<div class="wrapper"></div>',t+='<div class="po_line submit noselect"><div class="btn btn-white btn-sm" data-id="'+i.id+'">Повторить</div></div>',t+="</div>"):o=!0}),"1"==I.orders.attr("data-page")?I.ordersList.html(t):I.ordersList.append(t),I.orders.removeClass("d-none"),I.ordersList.find("*[data-link]").on("click",function(){if(e(this).hasClass("selected")||e(this).hasClass("disabled")||e(this).hasClass("empty"))return!1;window.location=e(this).attr("data-link")}),I.ordersList.find(".submit .btn").on("click",I.repeatOrder),o&&(I.ordersLoad.removeClass("d-none"),I.ordersLoad.find(".btn").on("click",function(){return I.orders.attr("data-page",parseInt(I.orders.attr("data-page"))+1),I.loadOrders(),!1}))},error:function(e){l.debug&&console.log(e.responseJSON)},complete:function(e){I.ordersMore.removeClass("disabled"),I.ordersMoreIcon.addClass("downarr").removeClass("load")}})},repeatOrder:function(){var t=e(this),o=t.attr("data-id");if(t.hasClass("disabled"))return!1;e.ajax("/cart/add/order",{cache:!1,dataType:"json",type:"POST",data:{order_id:o,return_cart:1,xhr:v()},beforeSend:function(){j.loading=!0,t.addClass("disabled")},success:function(e){if(void 0===e)return!1;b("CART_ADD"),j.showNotification("Добавлено","Заказ № "+o),j.firstLoaded=!0,j.data=e,j.redrawPanel()},error:function(e){l.debug&&console.log(e.responseJSON),n.fire({type:"error",title:"Ошибка",text:"Произошла ошибка во время добавления в корзину. Попробуйте еще раз",confirmButtonClass:"btn btn-color",buttonsStyling:!1})},complete:function(){j.loading=!1,t.removeClass("disabled")}})}},x=function(e,n,t,o){void 0===e&&(e=""),void 0===n&&(n=""),void 0===t&&(t=0),void 0===o&&(o={fiber:0,fat:0,carbohydrate:0,energy:0,weight:0}),this.id=e,this.name=n,this.price=t,this.bzu=o,this.relation=null,this.selectors={},this.modifiers={},this.modsLeft={},this.total=t,this.fromDish=function(e){this.id=e.id,this.name=e.name,this.price=e.price,this.bzu=p(e.bzu),this.relation=p(e.relation),this.selectors=p(e.selectors),this.modifiers=p(e.modifiers),this.modsLeft=p(e.modsLeft),this.total=e.total},this.recount=function(){for(var e in this.total=this.price,this.selectors)this.total+=this.selectors[e].price_raw;for(var e in this.modifiers)this.total+=this.modifiers[e].price_raw},this.getBzu=function(){var e=p(this.bzu);for(var n in this.selectors)e.fiber+=this.selectors[n].fiber_raw,e.fat+=this.selectors[n].fat_raw,e.carbohydrate+=this.selectors[n].carbohydrate_raw,e.energy+=this.selectors[n].energy_raw,e.weight+=this.selectors[n].weight_raw;for(var n in this.modifiers)e.fiber+=this.modifiers[n].fiber_raw,e.fat+=this.modifiers[n].fat_raw,e.carbohydrate+=this.modifiers[n].carbohydrate_raw,e.energy+=this.modifiers[n].energy_raw,e.weight+=this.modifiers[n].weight_raw;return e},this.setRelation=function(e){if("object"!=typeof e)return!1;this.id=e.product_id,this.price=e.price_raw,this.bzu.fiber=e.fiber_raw,this.bzu.fat=e.fat_raw,this.bzu.carbohydrate=e.carbohydrate_raw,this.bzu.energy=e.energy_raw,this.bzu.weight=e.weight_raw,this.relation=e,this.recount()},this.setSelector=function(e,n){if("object"!=typeof e||"string"!=typeof n)return!1;e.group_id=n,this.selectors[n]=e,this.recount()},this.addModifier=function(e,n,t){return"object"==typeof e&&"string"==typeof n&&void 0!==t&&((t=parseInt(t))>0&&(void 0!==this.modsLeft[n]?this.modsLeft[n]>0&&this.modsLeft[n]--:this.modsLeft[n]=t-1),e.group_id=n,this.modifiers[e.product_id]=e,this.recount(),t>0&&this.modsLeft[n]<=0?n:void 0)},this.removeModifier=function(e,n){if("string"!=typeof e)return!1;"string"==typeof n&&void 0!==this.modsLeft[n]&&this.modsLeft[n]++,delete this.modifiers[e],this.recount()},this.getTotalWithCurrency=function(){return h(this.total,l.currencyDecimals,l.decimalSeparator,l.thousandSeparator)+" "+l.currencySymbol},this.clear=function(){this.id="",this.name="",this.price=0,this.bzu={fiber:0,fat:0,carbohydrate:0,energy:0,weight:0},this.relation=null,this.selectors={},this.modifiers={},this.modsLeft={},this.total=0}},W={init:function(){if(W.product=e(".product"),W.items=e(".products .products_item"),W.isCart=e(".cart_container .cart_page").length>0,W.modWindowOpened=!1,W.isProductWindow=!1,W.isProductPage=W.product.length>0||!(W.items.length>0)&&null,null===W.isProductPage)return!1;W.isProductPage?W.initProduct():(W.items.find("a").on("click",W.openProductWindow),W.items.find(".foot.simple .cart-btn:not(.disabled)").on("click",W.addToCart),W.items.find(".foot.diff .cart-btn:not(.disabled)").on("click",W.openProductWindow))},uninit:function(){W.product=null,W.isCart=!1,W.isProductPage=!1;try{W.items.find("a").off("click"),W.items.find(".foot.simple .cart-btn:not(.disabled)").off("click"),W.items.find(".foot.diff .cart-btn:not(.disabled)").off("click")}catch(e){console.log(e)}W.items=null},initProduct:function(n){void 0!==n&&(W.isProductWindow=!0,W.product=n.find(".product")),W.isProductPage=!0,W.product.image=W.product.find(".product_image > img"),W.product.desc=W.product.find(".pp_desc"),W.product.bzu=W.product.find(".pp_nutrition"),W.product.weight=W.product.find(".pp_total > .ppt_weight"),W.product.total=W.product.find(".pp_total > .ppt_sum"),W.cartButton=W.product.find(".btn-color").on("click",W.addToCart),W.relations=W.product.find(".relations .ss_item").on("click",W.relationChange),W.selectors=W.product.find(".selectors .ss_item").on("click",W.selectorChange),W.modViewer=W.product.find(".pp_mods"),W.modOpenBtn=W.modViewer.find(".ppm_add").on("click",W.openModWindow),W.modInfo=e("#mods-info"),W.modWindow=e("#mods-window"),W.modWindow.find(".close-cross").on("click",function(){W.closeModWindow()}),W.dish=new x(W.product.attr("data-id"),W.product.attr("data-name"),parseFloat(W.product.attr("data-price")),JSON.parse(W.product.attr("data-bzu"))),W.relations.length>0&&W.relations.removeClass("selected").each(function(){if(!e(this).hasClass("disabled"))return e(this).trigger("click"),!1}),W.selectors.length>0&&W.product.find(".selectors").each(function(){e(this).find(".ss_item").removeClass("selected").each(function(){if(!e(this).hasClass("disabled"))return e(this).trigger("click"),!1})});var t=W.product.total.text(),o=-1!==t.indexOf(","),i=t.split(" "),a=i[i.length-1];l.currencyDecimals=o?2:0,l.currencySymbol=a,W.redrawView()},uninitProduct:function(){W.isProductWindow=!1,W.isProductPage=!1,W.cartButton.off("click"),W.relations.off("click"),W.selectors.off("click")},selectorPositioning:function(n){if(void 0===n)return!1;var t=n.parent(),o=t.width(),i=n.position(),a=n.outerWidth(!0),s=i.left+a,d=0;(i.left<0||s>o)&&(t.find(".ss_item").each(function(){if(e(this).hasClass("selected"))return!1;d+=e(this).outerWidth(!0)}),t.animate({scrollLeft:d-(o/2-a/2)},100))},relationChange:function(){if(e(this).hasClass("selected")||e(this).hasClass("disabled"))return!1;W.relations.removeClass("selected"),e(this).addClass("selected"),W.selectorPositioning(e(this));var n=JSON.parse(e(this).attr("data-info")),t=n.image_path.length>0?uploadsCdn+n.image_path:l.imagePlug;W.dish.setRelation(n),W.product.image.attr("src",t),W.product.desc.html(n.description),W.cartButton.hasClass("disabled")&&W.cartButton.removeClass("disabled").html('В корзину<div class="btn_icon cart"></div>'),W.redrawView()},selectorChange:function(){if(e(this).hasClass("selected")||e(this).hasClass("disabled"))return!1;e(this).parent().find(".ss_item").removeClass("selected"),e(this).addClass("selected"),W.selectorPositioning(e(this)),W.dish.setSelector(JSON.parse(e(this).attr("data-info")),e(this).closest(".switch-selector").attr("data-group")),W.redrawView()},modifierChange:function(){if(e(this).hasClass("disabled"))return!1;var n=JSON.parse(e(this).attr("data-info")),t=e(this).closest(".mwm_mod"),o=t.attr("data-group"),i=t.attr("data-max");e(this).hasClass("checked")?(e(this).removeClass("checked"),W.dishBuffer.removeModifier(n.product_id,o),W.modWindow.find(".mwm_mod[data-group="+o+"] .plus-btn:not(.checked):not(.md)").attr("title","").removeClass("disabled")):(e(this).addClass("checked"),"string"==typeof W.dishBuffer.addModifier(n,o,i)&&W.modWindow.find(".mwm_mod[data-group="+o+"] .plus-btn:not(.checked):not(.md)").attr("title","Максимум "+i).addClass("disabled")),W.modWindow.find(".mwt_sum > span").html(W.dishBuffer.getTotalWithCurrency())},applyModifiers:function(){if(W.dish.fromDish(W.dishBuffer),W.modInfo.html(W.modWindow.find(".window_body").html()),W.modViewer.find(".ppm_mod .close").off("click").each(function(){e(this).parent().remove()}),Object.keys(W.dish.modifiers).length>0){var n="";for(var t in W.dish.modifiers){var o=W.dish.modifiers[t];n+='<div class="ppm_mod" data-id="'+t+'" data-group="'+o.group_id+'">'+o.name+'<div class="close"></div></div>'}W.modViewer.prepend(n),W.modViewer.find(".ppm_mod .close").on("click",W.deleteModifier)}W.redrawView(),W.closeModWindow()},slideModifiers:function(){var n=e(this).hasClass("next")?1:-1,t=e(this).closest(".mwm_block").find(".mwm_list");t.animate({scrollLeft:t.scrollLeft()+130*n},100)},deleteModifier:function(){var n=e(this).parent(),t=n.attr("data-id"),o=n.attr("data-group");W.modInfo.find(".mwm_mod[data-id="+t+"] .plus-btn.checked").removeClass("checked"),W.modInfo.find(".mwm_mod[data-group="+o+"] .plus-btn:not(.checked):not(.md)").attr("title","").removeClass("disabled"),W.dish.removeModifier(t,o),W.redrawView(),n.remove()},redrawView:function(){var n=W.dish.getBzu(),t=[h(n.energy,2,l.decimalSeparator,l.thousandSeparator),h(n.fat,2,l.decimalSeparator,l.thousandSeparator),h(n.fiber,2,l.decimalSeparator,l.thousandSeparator),h(n.carbohydrate,2,l.decimalSeparator,l.thousandSeparator)],o=h(n.weight,0,l.decimalSeparator,l.thousandSeparator)+" г";W.product.bzu.find(".nut").each(function(n){e(this).find("span").html(t[n])}),W.product.weight.find("span").html(o),W.product.total.html(W.dish.getTotalWithCurrency())},addToCart:function(){var n=e(this),t=n.closest(".products_item"),o=t.attr("data-id"),i=t.attr("data-name"),a=t.attr("data-price");if(n.hasClass("disabled"))return!1;W.isProductPage||(W.dish=new x(o,i,parseFloat(a))),n.addClass("disabled"),j.addDish(W.dish,W.dish.name,function(){n.removeClass("disabled"),W.isCart&&"function"==typeof j.suggestAdded&&j.suggestAdded(W.dish)})},openProductWindow:function(n){n.preventDefault(),W.isProductWindow=!0,j.scrollTop=e(window).scrollTop();var t=e(document).prop("title"),i=e(this).closest(".products_item"),a=i.find("a").attr("href");W.loadContent=e('<div class="load-content"><div class="load-content_outer"><div class="load-content__container"><div class="load-content__close"></div><div class="load-content__inner"></div></div></div></div>').appendTo(o),W.loadContainer=W.loadContent.find(".load-content__inner"),e.ajax("/__ajax_product__"+a,{cache:!1,dataType:"html",type:"POST",data:{xhr:v()},success:function(n){if("string"!=typeof n)return window.location=a,!1;W.loadContainer.html(n),W.loadContent.find(".load-content__close").on("click",function(e){e.preventDefault(),W.isCart?W.closeProductWindow():window.history.back()}),e(".header_logo, .footer_logo, .nav_menu_item.selected, .hm_item.selected").on("click",function(e){e.preventDefault(),W.isCart?W.closeProductWindow():window.history.back()}).addClass("c-pointer"),W.isCart?W.loadContent.addClass("cart"):(e(document).prop("title",i.attr("data-name")),window.history.pushState(null,null,a),C(document.location.pathname),window.onpopstate=function(n){W.windowOpened&&(e(document).prop("title",t),W.closeProductWindow(),C(document.location.pathname))}),W.initProduct(W.loadContainer),W.loadContent.addClass("loaded"),_(!1),k(!0),W.windowOpened=!0},error:function(e){l.debug&&console.log(e.responseJSON),window.location=a}})},closeProductWindow:function(){W.uninitProduct(),W.loadContent.removeClass("loaded"),W.windowOpened=!1,W.isProductWindow=!1,e(".header_logo, .footer_logo, .nav_menu_item.selected, .hm_item.selected").off("click").removeClass("c-pointer"),k(!1),_(!0),e(window).scrollTop(j.scrollTop),setTimeout(function(){W.loadContent.remove()},250)},onBodyClick:function(n){var t=W.modWindow.find(".window_panel"),o=e(".swal2-container");W.modWindowOpened&&(!W.firstEvent||o.is(n.target)||0!==o.has(n.target).length||t.is(n.target)||0!==t.has(n.target).length||W.closeModWindow()),W.firstEvent=!0},openModWindow:function(){W.firstEvent=!1,o.on("click",W.onBodyClick),W.isProductWindow||(W.scrollTop=e(window).scrollTop(),_(!1)),W.dishBuffer=new x,W.dishBuffer.fromDish(W.dish),W.modWindow.find(".window_body").html(W.modInfo.html()),W.modWindow.find(".mwt_sum > span").html(W.dishBuffer.getTotalWithCurrency()),W.modWindow.find(".mwm_slider .slide").on("click",W.slideModifiers),W.modifiers=W.modWindow.find(".mwm_mod .plus-btn").on("click",W.modifierChange),W.modWindow.find(".mw_total .btn-color").on("click",W.applyModifiers),W.modWindow.addClass("opened").animate({opacity:1},100,function(){k(!0)}),W.modWindowOpened=!0},closeModWindow:function(){W.modWindow.animate({opacity:0},100,function(){e(this).removeClass("opened")}),W.modWindowOpened=!1,W.modWindow.find(".mwm_mod").off("click"),W.modWindow.find(".mw_total .btn-color").off("click"),o.off("click",W.onBodyClick),W.dishBuffer=null,W.isProductWindow||(k(!1),_(!0),e(window).scrollTop(W.scrollTop))}},j={init:function(){if(j.loading=!1,j.data=null,j.notificationOpened=!1,j.popupOpened=!1,j.loaderOpened=!1,j.firstLoaded=!1,j.waitPopup=!1,j.loader=e("#cart-loader"),j.page=e(".cart_container .cart_page"),j.popup=e("#cart-popup").on("mouseenter",j.openPopup).on("mouseleave",j.closePopup),j.isCartPage=j.page.length>0||!(j.popup.length>0)&&null,null===j.isCartPage)return!1;j.notification=e("#cart-notification"),j.loadParams={},j.isCartPage?(j.loadParams.with_coupon=1,j.loadParams.check_order_available=1,j.cartBlock=j.page,j.sumBlock=e(".cart_sidebar .sp_block:first-child"),j.personsSelector=e(".cart_sidebar .sp_persons .count-selector"),j.couponInput=e(".cart_sidebar .sp_promo input"),j.couponCheck=e(".cart_sidebar .sp_promo .btn"),j.submitBtn=e(".cart_sidebar .sp_submit"),j.notWorkingBlock=e(".cart_sidebar .cart-notice"),j.redrawPage()):(j.popupBtn=e(".header_container .cart-btn").on("mouseenter",j.openPopup).on("mouseleave",j.closePopup),j.load())},load:function(n){if(j.loading)return!1;j.loadParams.xhr=v(),e.ajax("/cart/get",{cache:!1,dataType:"json",type:"POST",data:j.loadParams,beforeSend:function(){j.loading=!0},success:function(e){if(void 0===e)return!1;j.firstLoaded=!0,j.data=e,j.isCartPage?j.redrawPage(n):j.redrawPanel(n)},error:function(e){l.debug&&console.log(e.responseJSON)},complete:function(){j.loading=!1}})},redrawPanel:function(e){var n=null===j.data,t=j.popup.find(".cp_products"),o="contain"==j.popup.attr("data-image"),i="";if(t.find(".count-selector .minus").off("click"),t.find(".count-selector .plus").off("click"),t.find(".delete-cross").off("click"),n&&j.popupOpened&&j.closePopup(),j.popupBtn.find(".sum").html(n?"":j.data.pay_sum),j.popupBtn.find(".count").html(n?"":j.data.count),j.popup.find(".cpp_total .sum").html(n?"":j.data.pay_sum),n?j.popupBtn.addClass("empty"):j.popupBtn.removeClass("empty"),n)return"function"==typeof e&&e(),!1;for(var a in j.data.list){var s=j.data.list[a],d=s.image_path.length>0?uploadsCdn+s.image_path:l.imagePlug,r=!(s.image_path.length>0)||o,c=[];if(s.relation_name.length>0&&c.push(s.relation_name),"object"==typeof s.selectors)for(var u in s.selectors)c.push(s.selectors[u].name);"object"==typeof s.extra_added&&s.extra_added.length>0&&c.push(f(s.extra_added.length,["доп","допа","допов"])),i+='<div class="cpp_item" data-hash="'+s.combo_hash+'" data-amount="'+s.amount+'">',i+='<div class="delete-cross"></div>',i+='<img src="'+d+'" class="image'+(r?" contain":"")+'">',i+='<div class="cpp_info">',i+='<div class="name">'+s.name+"</div>",i+='<div class="dop">'+c.join(", ")+"</div>",i+='<div class="cpp_action">',i+='<div class="count-selector noselect">',i+='<div class="minus'+(s.amount<2?" disabled":"")+'"></div>',i+='<div class="count">'+s.amount+"</div>",i+='<div class="plus'+(s.amount>98?" disabled":"")+'"></div>',i+="</div>",i+='<div class="sum">'+s.pay_sum+"</div>",i+="</div>",i+="</div>",i+="</div>"}t.html(i),t.find(".count-selector .minus").on("click",j.selectorAmount),t.find(".count-selector .plus").on("click",j.selectorAmount),t.find(".delete-cross").on("click",j.removeItem),j.data.list.length>3?t.css({height:330}).addClass("scroll-vert"):t.css({height:"auto"}).removeClass("scroll-vert"),"function"==typeof e&&e()},selectorAmount:function(){if(e(this).hasClass("disabled"))return!1;var n=e(this).closest(".cl_item, .cpp_item"),t=n.attr("data-hash"),o=parseInt(n.attr("data-amount"));e(this).hasClass("minus")?o--:o++,e(this).addClass("disabled"),j.changeAmount(t,o)},removeItem:function(){e(this).addClass("disabled"),j.changeAmount(e(this).closest(".cl_item, .cpp_item").attr("data-hash"),0)},redrawPage:function(n){var t=null===j.data,o="contain"==j.cartBlock.attr("data-image"),i="";if(j.firstLoaded){if(t)return window.location="/",!1;var a=null!==j.data.order_off,s=!1;for(var d in j.cartBlock.find(".count-selector .minus").off("click"),j.cartBlock.find(".count-selector .plus").off("click"),j.cartBlock.find(".delete-cross").off("click"),j.personsSelector.find(".minus").off("click"),j.personsSelector.find(".plus").off("click"),j.couponInput.off("keypress"),j.couponCheck.off("click"),j.submitBtn.off("click"),j.data.list){var r=j.data.list[d],c=r.image_path.length>0?uploadsCdn+r.image_path:l.imagePlug,u=!(r.image_path.length>0)||o,p=[],f=[],h=[];if(r.relation_name.length>0&&f.push(r.relation_name),"object"==typeof r.selectors)for(var m in r.selectors)f.push(r.selectors[m].name);if("object"==typeof r.extra_added)for(var m in r.extra_added)h.push(r.extra_added[m].name);f.length>0&&p.push(f.join(", ")),h.length>0&&p.push("Добавлено: "+h.join(", ")),0==f.length&&0==h.length&&p.push(r.description),i+='<div class="cl_item'+(r.is_banned?" disabled":"")+'" title="'+r.ban_reason+'" data-hash="'+r.combo_hash+'" data-amount="'+r.amount+'">',r.is_banned&&(s=!0),i+='<img src="'+c+'" class="image'+(u?" contain":"")+'">',i+='<div class="cl_info">',i+='<div class="name">'+r.name+"</div>",i+='<div class="dop">'+p.join("<br>")+"</div>",i+="</div>",i+='<div class="wrapper"></div>',i+='<div class="cl_action">',i+='<div class="count-selector noselect">',i+='<div class="minus"></div>',i+='<div class="count">'+r.amount+"</div>",i+='<div class="plus'+(r.amount>98?" disabled":"")+'"></div>',i+="</div>",i+='<div class="sum">'+r.pay_sum+"</div>",i+="</div>",i+='<div class="delete-cross noselect"></div>',i+="</div>"}j.cartBlock.html(i),j.sumBlock.find(".total .spp_sum").html(j.data.sum),j.sumBlock.find(".discount .spp_sum").html(j.data.discount),j.sumBlock.find(".pay .spp_sum").html(j.data.pay_sum),j.data.discount_raw>0?(j.sumBlock.find(".total").removeClass("d-none"),j.sumBlock.find(".discount").removeClass("d-none")):(j.sumBlock.find(".total").addClass("d-none"),j.sumBlock.find(".discount").addClass("d-none")),null!==j.data.coupon?(j.couponInput.val(j.data.coupon.code).prop("readonly",!0),j.couponCheck.addClass("cancel").html("Отменить")):(j.couponInput.val("").prop("readonly",!1),j.couponCheck.removeClass("cancel").html("Применить")),a?j.notWorkingBlock.addClass("cn_clock"):j.notWorkingBlock.removeClass("cn_clock"),s||a?(j.notWorkingBlock.removeClass("d-none").html(a?j.data.order_off:"Некоторые блюда, в&nbsp;данный момент, недоступны к&nbsp;заказу. Для оформления заказа необходимо удалить их&nbsp;из&nbsp;корзины"),j.submitBtn.addClass("disabled")):(j.notWorkingBlock.addClass("d-none").html(""),j.submitBtn.removeClass("disabled"))}j.cartBlock.find(".count-selector .minus").on("click",j.selectorAmount),j.cartBlock.find(".count-selector .plus").on("click",j.selectorAmount),j.cartBlock.find(".delete-cross").on("click",j.removeItem),j.personsSelector.find(".minus").on("click",j.selectorPersons),j.personsSelector.find(".plus").on("click",j.selectorPersons),j.couponInput.on("keypress",function(n){13!=n.keyCode||e(this).prop("readonly")||j.changeCoupon()}),j.couponCheck.on("click",j.changeCoupon),j.submitBtn.on("click",j.onSubmitClick),j.loadSuggest(),"function"==typeof n&&n()},selectorPersons:function(){if(e(this).hasClass("disabled"))return!1;var n=j.personsSelector.find(".count"),t=parseInt(j.personsSelector.attr("data-max")),o=parseInt(n.text());e(this).hasClass("minus")?o--:o++,o<2?j.personsSelector.find(".minus").addClass("disabled"):j.personsSelector.find(".minus").removeClass("disabled"),o>=t?j.personsSelector.find(".plus").addClass("disabled"):j.personsSelector.find(".plus").removeClass("disabled"),j.changePersons(o),n.text(o)},changeCoupon:function(t){var o=j.couponInput.val(),i=j.couponCheck.hasClass("cancel")?"/cart/coupon/remove":"/cart/coupon/set",a="function"==typeof t,s={code:o,return_cart:1};if(0==o.length||j.loading)return!1;for(var d in j.loadParams)s[d]=j.loadParams[d];s.xhr=v(),e.ajax(i,{cache:!1,dataType:"json",type:"POST",data:s,beforeSend:function(){j.loading=!0,j.couponInput.prop("disabled",!0),j.couponCheck.addClass("disabled")},success:function(e){if(void 0===e)return!1;j.firstLoaded=!0,j.data=e,j.redrawPage()},error:function(e){l.debug&&console.log(e.responseJSON),a||(void 0===e.responseJSON||403!=e.status&&404!=e.status?n.fire({type:"error",title:"Ошибка",text:"Произошла ошибка во время применения промокода. Попробуйте еще раз",confirmButtonClass:"btn btn-color",buttonsStyling:!1}):n.fire({type:"warning",text:void 0!==e.responseJSON?e.responseJSON.error:null,confirmButtonClass:"btn btn-color",buttonsStyling:!1}))},complete:function(){j.loading=!1,j.couponInput.prop("disabled",!1),j.couponCheck.removeClass("disabled"),a&&t()}})},createOrder:function(){e.ajax("/cart/order/create",{cache:!1,dataType:"json",type:"POST",data:{xhr:v()},beforeSend:function(){j.submitBtn.addClass("disabled")},success:function(){window.location="/cart/address"},error:function(e){l.debug&&console.log(e.responseJSON),void 0!==e.responseJSON&&403==e.status?n.fire({type:"warning",text:void 0!==e.responseJSON?e.responseJSON.error:null,confirmButtonClass:"btn btn-color",buttonsStyling:!1}).then(function(){j.load()}):n.fire({type:"error",title:"Ошибка",text:"Произошла ошибка во время оформления заказа",confirmButtonClass:"btn btn-color",buttonsStyling:!1})},complete:function(){j.submitBtn.removeClass("disabled")}})},onSubmitClick:function(){if(e(this).hasClass("disabled"))return!1;w()?j.couponInput.val().length>0&&!j.couponCheck.hasClass("cancel")?j.changeCoupon(j.createOrder):j.createOrder():(N.initiator=j.submitBtn,N.openWindow(function(e){i=e,j.couponInput.val().length>0&&!j.couponCheck.hasClass("cancel")?j.changeCoupon(j.createOrder):j.createOrder()}))},changePersons:function(n){e.ajax("/cart/persons/set",{cache:!1,dataType:"json",type:"POST",data:{amount:n,xhr:v()},error:function(e){l.debug&&console.log(e.responseJSON)}})},showNotification:function(n,t){if(j.notificationOpened)return j.notification.find(".title").html(n),j.notification.find(".text").html(t),!1;var o,i,a,s,d,r,l,c,u,p,f=e(".body_container"),h=80,m=e(window).width()-(f.offset().left+f.outerWidth());!j.isCartPage||(o=".cart-header",i=document.querySelector(o),a=window.pageYOffset+i.getBoundingClientRect().top,s=window.pageXOffset+i.getBoundingClientRect().left,d=window.pageXOffset+i.getBoundingClientRect().right,r=window.pageYOffset+i.getBoundingClientRect().bottom,l=window.pageYOffset,c=window.pageXOffset,u=window.pageXOffset+document.documentElement.clientWidth,p=window.pageYOffset+document.documentElement.clientHeight,r>l&&a<p&&d>c&&s<u)||(h=20),j.notification.css({top:h,right:m}),j.notification.find(".title").html(n),j.notification.find(".text").html(t),j.notification.addClass("opened").animate({opacity:1},200),j.notificationOpened=!0,setTimeout(function(){j.notification.animate({opacity:0},200,function(){e(this).removeClass("opened"),j.notificationOpened=!1})},1500)},suggestAdded:function(e){j.load(),W.windowOpened&&W.closeProductWindow()},addDish:function(t,o,i){if("object"!=typeof t)return!1;var a={product_id:"",selectors:null,extra_added:null,price:0,return_cart:!0};for(var s in j.loadParams)a[s]=j.loadParams[s];for(var d in a.product_id=t.id,a.price=t.total,t.selectors){var r=t.selectors[d];null===a.selectors&&(a.selectors=[]),a.selectors.push({group_id:r.group_id,modifier_id:r.product_id,name:r.name,price:r.price_raw,amount:1})}for(var d in t.modifiers){var c=t.modifiers[d];null===a.extra_added&&(a.extra_added=[]),a.extra_added.push({group_id:c.group_id,modifier_id:c.product_id,name:c.name,price:c.price_raw,amount:1})}a.xhr=v(),e.ajax("/cart/add",{cache:!1,dataType:"json",type:"POST",data:a,beforeSend:function(){j.loading=!0},success:function(e){if(void 0===e)return!1;b("CART_ADD"),j.showNotification("Добавлено",o),j.firstLoaded=!0,j.data=e,j.isCartPage?j.redrawPage():j.redrawPanel()},error:function(e){l.debug&&console.log(e.responseJSON),n.fire({type:"error",title:"Ошибка",text:"Произошла ошибка во время добавления в корзину. Попробуйте еще раз",confirmButtonClass:"btn btn-color",buttonsStyling:!1})},complete:function(){j.loading=!1,"function"==typeof i&&i()}})},changeAmount:function(t,o){if(j.loading)return!1;var i={combo_hash:t,amount:o,return_cart:1};for(var a in j.loadParams)i[a]=j.loadParams[a];i.xhr=v(),e.ajax("/cart/change",{cache:!1,dataType:"json",type:"POST",data:i,beforeSend:function(){j.loading=!0},success:function(e){if(void 0===e)return!1;j.firstLoaded=!0,j.data=e,j.isCartPage?j.redrawPage():j.redrawPanel()},error:function(e){l.debug&&console.log(e.responseJSON),n.fire({type:"error",title:"Ошибка",text:"Произошла ошибка во время изменения количества. Попробуйте еще раз",confirmButtonClass:"btn btn-color",buttonsStyling:!1})},complete:function(){j.loading=!1}})},openPopup:function(){if(!S()){if(j.waitPopup=!0,null===j.data)return!1;if(j.popupOpened)return!1;var n=j.popupBtn.offset().top+j.popupBtn.outerHeight()+15-e(window).scrollTop(),t=e(window).width()-(j.popupBtn.offset().left+j.popupBtn.outerWidth());j.popup.css({top:n,right:t}),j.loadParams.check_minimal=0,j.load(function(){j.popup.addClass("opened").animate({opacity:1},100),j.popupOpened=!0})}},closePopup:function(){if(j.waitPopup=!1,!j.popupOpened)return!1;setTimeout(function(){if(j.waitPopup)return!1;j.loadParams.check_minimal=0,j.popup.animate({opacity:0},100,function(){e(this).removeClass("opened")}),j.popupOpened=!1},400)},openLoader:function(){if(j.loaderOpened)return!1;j.loader.removeClass("d-none").animate({opacity:1},100),j.loaderOpened=!0},closeLoader:function(){if(!j.loaderOpened)return!1;j.loader.addClass("d-none").css({opacity:0}),j.loaderOpened=!1},loadSuggest:function(){e.ajax("/cart/suggest",{cache:!1,dataType:"html",type:"POST",data:{xhr:v()},success:function(n){if("string"!=typeof n||0==n.length)return!1;e(".load_suggest").html('<div class="block-title">Рекомендуем к заказу</div>'+n),setTimeout(function(){W.uninit(),W.init()},100)},error:function(e){l.debug&&console.log(e.responseJSON)}})}},A=function(n,t,o,i,a,s){var d=function(e){"function"==typeof s&&s(e)},r=i.val(),c=a.val(),u=null,p=null,f=function(e,t,s){void 0===s&&(s=!1),r=t.item.value,n.val(t.item.id).trigger("keyup"),o.val(t.item.city),i.val(r),a.val("").removeClass("valid").removeClass("invalid").focus(),p=null,d(i),s||a.focus()},h=function(e,n){c=n.item.value,a.attr("data-id",n.item.id),t.val(n.item.addr).trigger("keyup"),a.val(c),d(a)};i.autocomplete({minLength:1,delay:0,autoFocus:!0,source:function(n,t){e.ajax("/cart/streets/find",{cache:!1,dataType:"json",type:"POST",data:{query:n.term,xhr:v()},success:function(e){t(e)},error:function(e){l.debug&&console.log(e.responseJSON)}})},select:f,focus:function(e,n){u=n}}).on("blur",function(){r!=e(this).val()&&(null!==u?f(0,u,!0):(i.val("").removeClass("valid").removeClass("invalid"),a.val("").removeClass("valid").removeClass("invalid"),u=null,p=null))}),a.autocomplete({minLength:1,delay:0,autoFocus:!0,source:function(t,o){e.ajax("/cart/houses/find",{cache:!1,dataType:"json",type:"POST",data:{street_id:n.val(),query:t.term,xhr:v()},success:function(e){o(e)},error:function(e){l.debug&&console.log(e.responseJSON)}})},select:h,focus:function(e,n){p=n}}).on("blur",function(){c!=e(this).val()&&(null!==p?h(0,p):(a.val("").removeClass("valid").removeClass("invalid"),p=null))})},J={dp:{is_can_delivery:!1},init:function(){if(J.checking=!1,J.loading=!1,J.page=e(".cart_container .address_page"),0==J.page.length)return!1;J.name=J.page.find(".guest-name input").on("keyup",J.submitCheck),J.phone=J.page.find(".guest-phone input").mask("+7 000 000-00-00").on("click",J.changePhone),J.selector=J.page.find(".delivery-types"),J.justPickup=J.selector.find(".dt_delivery.disabled").length>0,J.isPickup=J.justPickup||"pickup"==J.page.attr("data-type"),J.addrPanel=J.page.find(".address-list.addr"),J.pickupPanel=J.page.find(".address-list.shop"),J.newAddrPanel=J.page.find(".cb_plate.newaddr"),J.addrItems=J.addrPanel.find(".al_item").on("click",J.onAddrClick),J.pickupItems=J.pickupPanel.find(".al_item").on("click",J.onPickupClick),J.justPickup||(J.isAutocomplete="on"==J.newAddrPanel.attr("data-autocomplete"),J.kladr=J.newAddrPanel.find(".hidden-kladr"),J.addr=J.newAddrPanel.find(".hidden-addr"),J.city=J.newAddrPanel.find(".hidden-city"),J.street=J.newAddrPanel.find(".street"),J.house=J.newAddrPanel.find(".house"),J.apartment=J.newAddrPanel.find(".apartment"),J.entrance=J.newAddrPanel.find(".entrance"),J.floor=J.newAddrPanel.find(".floor"),J.isAutocomplete?J.autocomplete=new A(J.kladr,J.addr,J.city,J.street,J.house,function(){J.addrPanel.find(".selected").removeClass("selected").find("input").prop("checked",!1),J.submitCheck()}):(J.street.on("keyup",J.onAddrKeyUp),J.house.on("keyup",J.onAddrKeyUp))),J.justPickup||0!=J.street.val().length||0!=J.addrPanel.find(".selected").length||J.addrPanel.find(".al_item:first-child").addClass("selected").find("input").prop("checked",!0),0==J.pickupPanel.find(".selected").length&&J.pickupPanel.find(".al_item:first-child").addClass("selected").find("input").prop("checked",!0),J.onTimeSelector=J.page.find("#ontime-select"),J.comment=J.page.find(".cart_comment textarea"),J.sidebar=e(".cart_container .cart_sidebar"),J.orderSumBlock=J.sidebar.find(".sp_price.pay"),J.deliveryPriceBlock=J.sidebar.find(".sp_price.dlv"),J.totalBlock=J.sidebar.find(".sp_price.total"),J.minimalNotice=J.sidebar.find(".minimum_order"),J.deliveryNotice=J.sidebar.find(".free_delivery"),J.zoneNotice=J.sidebar.find(".cart-notice"),J.submitBtn=J.sidebar.find(".sp_submit").on("click",J.bindAddress),J.justPickup||J.selector.find(".dt_type").on("click",J.onSelectorChange);var n=J.totalBlock.attr("data-with"),t=-1!==n.indexOf(","),o=n.split(" "),i=o[o.length-1];l.currencyDecimals=t?2:0,l.currencySymbol=i,J.updateElements()},onAddrKeyUp:function(){J.addrPanel.find(".selected").removeClass("selected").find("input").prop("checked",!1),J.submitCheck()},changePhone:function(){N.changePhone=!0,N.initiator=J.phone,N.openWindow(function(){J.phone.val(N.phoneInput.val()),N.changePhone=!1})},getDeliveryParams:function(){if(J.checking)return!1;var t="",o=J.addrPanel.find(".selected");if(o.length>0){var i=JSON.parse(o.attr("data-info"));if(void 0!==i.addr)t=i.addr;else{if(void 0===i.city||void 0===i.street||void 0===i.house)return!1;t=i.city+", "+i.street+", "+i.house}}else{if(!(J.street.val().length>0&&J.house.val().length>0))return!1;t=J.addr.val().length>0?J.addr.val():J.city.val()+", "+J.street.val()+", "+J.house.val()}J.checking=!0,e.ajax("/cart/delivery-params",{cache:!1,dataType:"json",type:"POST",data:{addr:t,xhr:v()},success:function(e){if(J.isPickup)return!1;J.zoneNotice.addClass("d-none"),J.dp=e,J.deliveryPriceBlock.find(".spp_sum").html(h(J.dp.delivery_price,l.currencyDecimals,l.decimalSeparator,l.thousandSeparator)+" "+l.currencySymbol),J.totalBlock.attr("data-with",J.dp.pay_sum_with_delivery),J.totalBlock.find(".spp_sum").html(J.totalBlock.attr("data-with")),J.submitCheck()},error:function(e){if(l.debug&&console.log(e.responseJSON),J.isPickup)return!1;void 0!==e.responseJSON&&403==e.status?(J.dp.is_can_delivery=!1,void 0!==e.responseJSON?J.zoneNotice.html(e.responseJSON.error):J.zoneNotice.html("Адрес находится вне зоны доставки"),J.zoneNotice.removeClass("d-none"),J.submitCheck()):void 0!==e.responseJSON&&404==e.status?(J.dp.is_can_delivery=!1,J.zoneNotice.addClass("d-none"),J.submitCheck(),n.fire({type:"warning",text:void 0!==e.responseJSON?e.responseJSON.error:null,confirmButtonClass:"btn btn-color",buttonsStyling:!1})):303==e.status?window.location="/cart/timeout":(J.dp.is_can_delivery=!1,J.submitCheck(),n.fire({type:"error",title:"Ошибка",text:"Произошла ошибка во время проверки адреса",confirmButtonClass:"btn btn-color",buttonsStyling:!1}))},complete:function(){J.checking=!1}})},submitCheck:function(){var e=!0;0==J.name.val().length?(J.name.addClass("invalid"),e=!1):J.name.removeClass("invalid"),J.isPickup?0!=J.pickupItems.length&&0!=J.pickupItems.find("input:checked")||(e=!1):(J.getDeliveryParams(),0==J.addrPanel.find("input:checked").length&&(0==J.street.val().length?(J.street.removeClass("valid").addClass("invalid"),e=!1):J.street.removeClass("invalid").addClass("valid"),0==J.house.val().length?(J.house.removeClass("valid").addClass("invalid"),e=!1):J.house.removeClass("invalid").addClass("valid")),J.dp.is_can_delivery?(void 0!==J.dp.free_delivery_left&&J.dp.free_delivery_left>0?J.deliveryNotice.removeClass("d-none").find("span").html(J.dp.free_delivery_left+" "+l.currencySymbol):J.deliveryNotice.addClass("d-none"),J.minimalNotice.addClass("d-none")):(void 0!==J.dp.minimum_order&&J.zoneNotice.hasClass("d-none")?J.minimalNotice.removeClass("d-none").find("span").html(J.dp.minimum_order+" "+l.currencySymbol):J.minimalNotice.addClass("d-none"),J.deliveryNotice.addClass("d-none"),e=!1)),e?J.submitBtn.removeClass("disabled"):J.submitBtn.addClass("disabled")},updateElements:function(){J.isPickup?(J.minimalNotice.addClass("d-none"),J.zoneNotice.addClass("d-none"),J.addrPanel.addClass("d-none"),J.newAddrPanel.addClass("d-none"),J.pickupPanel.removeClass("d-none"),J.deliveryNotice.addClass("d-none"),J.onTimeSelector.length>0&&J.onTimeSelector.parent().find(".cco_title").html("Время самовывоза"),J.orderSumBlock.length>0&&J.orderSumBlock.addClass("d-none"),J.deliveryPriceBlock.length>0&&J.deliveryPriceBlock.addClass("d-none"),J.totalBlock.find(".spp_sum").html(J.totalBlock.attr("data-without"))):(J.getDeliveryParams(),J.addrPanel.removeClass("d-none"),J.newAddrPanel.removeClass("d-none"),J.pickupPanel.addClass("d-none"),J.onTimeSelector.length>0&&J.onTimeSelector.parent().find(".cco_title").html("Время доставки"),J.orderSumBlock.length>0&&J.orderSumBlock.removeClass("d-none"),J.deliveryPriceBlock.length>0&&J.deliveryPriceBlock.removeClass("d-none"),J.totalBlock.find(".spp_sum").html(J.totalBlock.attr("data-with"))),J.submitCheck()},onSelectorChange:function(){if(e(this).hasClass("selected")||e(this).hasClass("disabled"))return!1;e(this).parent().find(".dt_type.selected").removeClass("selected"),e(this).addClass("selected"),J.isPickup="pickup"==e(this).attr("data-type"),J.updateElements()},onPickupClick:function(){e(this).parent().find(".selected").removeClass("selected").find("input").prop("checked",!1),e(this).addClass("selected").find("input").prop("checked",!0),J.submitCheck()},onAddrClick:function(){e(this).parent().find(".selected").removeClass("selected").find("input").prop("checked",!1),e(this).addClass("selected").find("input").prop("checked",!0),J.kladr.val(""),J.addr.val(""),J.city.val(""),J.street.val("").removeClass("valid invalid"),J.house.val("").removeClass("valid invalid"),J.apartment.val(""),J.entrance.val(""),J.floor.val(""),J.submitCheck()},bindAddress:function(){if(e(this).hasClass("disabled"))return!1;var t={type:J.isPickup?"pickup":"delivery",name:J.name.val(),on_time:J.onTimeSelector.val(),comment:J.comment.val()};if(J.isPickup)t.shop_id=J.pickupItems.find("input:checked").val();else{var o=J.addrPanel.find(".selected");if(o.length>0){var i=JSON.parse(o.attr("data-info"));void 0!==i.kladr_id&&(t.kladr_id=i.kladr_id),void 0!==i.addr&&(t.addr=i.addr),void 0!==i.city&&(t.city=i.city),void 0!==i.street&&(t.street=i.street),void 0!==i.house&&(t.house=i.house),void 0!==i.apartment&&(t.apartment=i.apartment),void 0!==i.entrance&&(t.entrance=i.entrance),void 0!==i.floor&&(t.floor=i.floor)}else t.kladr_id=J.kladr.val(),t.addr=J.addr.val(),t.city=J.city.val(),t.street=J.street.val(),t.house=J.house.val(),t.apartment=J.apartment.val(),t.entrance=J.entrance.val(),t.floor=J.floor.val()}t.xhr=v(),e.ajax("/cart/order/bind-address",{cache:!1,dataType:"json",type:"POST",data:t,beforeSend:function(){J.submitBtn.addClass("disabled"),j.openLoader()},success:function(){window.location="/cart/pay"},error:function(e){l.debug&&console.log(e.responseJSON),void 0!==e.responseJSON&&403==e.status?n.fire({type:"warning",text:void 0!==e.responseJSON?e.responseJSON.error:null,confirmButtonClass:"btn btn-color",buttonsStyling:!1}):303==e.status?window.location="/cart":404==e.status?window.location="/cart/timeout":n.fire({type:"error",title:"Ошибка",text:"Произошла ошибка во время подтверждения адреса",confirmButtonClass:"btn btn-color",buttonsStyling:!1}),j.closeLoader()},complete:function(){J.submitBtn.removeClass("disabled")}})}},z={init:function(){if(z.loading=!1,z.page=e(".cart_container .pay_page"),0==z.page.length)return!1;z.types=z.page.find(".pay-types .pt_selector").on("click",z.onTypeChange),z.cashChange=z.page.find(".cashback"),z.cashChangeInput=z.cashChange.find("input").mask("0#").on("keyup",z.onCashInputChange).on("blur",z.onCashInputChange),z.cashChangeLeft=z.cashChange.find(".cash-change"),z.plazius=z.page.find(".plazius"),z.isPlaziusAvailable=z.plazius.length>0,z.isPlaziusAvailable&&(z.plaziusRange=z.plazius.find("#bonusRange"),require(["rangeslider"],function(){z.plaziusRange.ionRangeSlider({keyboard:!1,skin:"round",onChange:z.onPlaziusRangeChange}),z.plaziusRangeInstance=z.plaziusRange.data("ionRangeSlider")})),z.sidebar=e(".cart_container .cart_sidebar"),z.orderSumBlock=z.sidebar.find(".sp_price.pay"),z.isOrderSumHidden=z.orderSumBlock.hasClass("d-none"),z.plaziusPayBlock=z.sidebar.find(".sp_price.plz"),z.totalBlock=z.sidebar.find(".sp_price.total"),z.submitBtn=z.sidebar.find(".sp_submit").on("click",z.payOrder);var n=z.plaziusPayBlock.attr("data-start"),t=-1!==n.indexOf(","),o=n.split(" "),i=o[o.length-1];l.currencyDecimals=t?2:0,l.currencySymbol=i},onTypeChange:function(){if(e(this).hasClass("selected"))return!1;e(this).parent().find(".selected").removeClass("selected").find("input").prop("checked",!1).closest(".pt_selector").find(".pts_line:nth-child(2)").slideUp(100),e(this).addClass("selected").find("input").prop("checked",!0).closest(".pt_selector").find(".pts_line:nth-child(2)").slideDown(100),z.onCashInputChange(),"online"===e(this).find("input").attr("data-type")?z.submitBtn.html("Оплатить заказ"):z.submitBtn.html("Подтвердить заказ"),"cash"===e(this).find("input").attr("data-type")&&z.cashChangeInput.focus()},onCashInputChange:function(){if(0==z.cashChangeInput.val().length||"cash"!==z.page.find(".pay-types input:checked").attr("data-type"))return z.cashChangeInput.removeClass("invalid"),z.cashChangeLeft.addClass("d-none"),z.submitBtn.removeClass("disabled"),!1;var e=parseFloat(z.cashChangeInput.val()),n=parseFloat(z.totalBlock.attr("data-total"))-parseFloat(z.plaziusPayBlock.attr("data-plazius")),t=e-n;e<=n?(z.cashChangeInput.addClass("invalid"),z.submitBtn.addClass("disabled"),z.cashChangeLeft.addClass("d-none")):(z.cashChangeInput.removeClass("invalid"),z.submitBtn.removeClass("disabled"),isNaN(e)||z.cashChangeLeft.removeClass("d-none").find("span").html(h(t,l.currencyDecimals,l.decimalSeparator,l.thousandSeparator)+" "+l.currencySymbol))},onPlaziusRangeChange:function(e){var n=parseFloat(z.totalBlock.attr("data-total"))-e.from;z.plaziusPayBlock.attr("data-plazius",e.from).find(".spp_sum").html("&minus;"+h(e.from,l.currencyDecimals,l.decimalSeparator,l.thousandSeparator)+" "+l.currencySymbol),z.totalBlock.find(".spp_sum").html(h(n,l.currencyDecimals,l.decimalSeparator,l.thousandSeparator)+" "+l.currencySymbol),e.from>0?(z.plaziusPayBlock.removeClass("d-none"),z.isOrderSumHidden&&z.orderSumBlock.removeClass("d-none")):(z.plaziusPayBlock.addClass("d-none"),z.isOrderSumHidden&&z.orderSumBlock.addClass("d-none")),z.onCashInputChange()},payOrder:function(){if(e(this).hasClass("disabled"))return!1;var t=z.page.find(".pay-types input:checked").attr("data-type"),o=z.plaziusPayBlock.attr("data-type"),i={payment_type:t,cash_change:"cash"===t?z.cashChangeInput.val():""};i[o]=z.plaziusPayBlock.attr("data-plazius"),i.xhr=v(),e.ajax("/cart/order/pay",{cache:!1,dataType:"json",type:"POST",data:i,beforeSend:function(){z.submitBtn.addClass("disabled"),j.openLoader()},success:function(t){void 0!==t.guid?window.location="/cart/success?id="+t.guid:void 0!==t.payment&&"sberbank"===t.payment?window.location=t.params.payment_url:void 0!==t.payment&&"cloudpayments"===t.payment?require(["https://widget.cloudpayments.ru/bundles/cloudpayments"],function(){j.closeLoader(),(new cp.CloudPayments).pay("auth",{publicId:t.params.public_id,description:"Оплата заказа № "+t.params.invoice_id,amount:t.params.amount,currency:"RUB",invoiceId:t.params.invoice_id,accountId:t.params.account_id,skin:"mini",data:{name:t.params.guest_name,phone:t.params.guest_phone,address:t.params.guest_address,shop:t.params.shop_name},requireEmail:!1},{onSuccess:function(){e.ajax("/cart/order/pay/confirm",{cache:!1,dataType:"json",type:"POST",data:{payment_hash:t.params.payment_hash,xhr:v()},beforeSend:function(){j.openLoader()},success:function(e){if("string"!=typeof e)return n.fire({type:"error",title:"Ошибка",text:"Произошла ошибка при подтверждении заказа",confirmButtonClass:"btn btn-color",buttonsStyling:!1}),!1;window.location="/cart/success?id="+e},error:function(e){l.debug&&console.log(e.responseJSON),void 0!==e.responseJSON&&403==e.status?n.fire({type:"warning",text:void 0!==e.responseJSON?e.responseJSON.error:null,confirmButtonClass:"btn btn-color",buttonsStyling:!1}):n.fire({type:"error",title:"Ошибка",text:"Произошла ошибка при подтверждении заказа",confirmButtonClass:"btn btn-color",buttonsStyling:!1})},complete:function(){j.closeLoader()}})}})}):(n.fire({type:"error",title:"Ошибка",text:"Произошла ошибка при подтверждении заказа",confirmButtonClass:"btn btn-color",buttonsStyling:!1}),j.closeLoader())},error:function(e){l.debug&&console.log(e.responseJSON),void 0!==e.responseJSON&&403==e.status?n.fire({type:"warning",text:void 0!==e.responseJSON?e.responseJSON.error:null,confirmButtonClass:"btn btn-color",buttonsStyling:!1}):404==e.status?window.location="/cart/timeout":n.fire({type:"error",title:"Ошибка",text:"Произошла ошибка при подтверждении заказа",confirmButtonClass:"btn btn-color",buttonsStyling:!1}),j.closeLoader()},complete:function(){z.submitBtn.removeClass("disabled")}})}},L={init:function(){return L.page=e(".cart_container .success_page"),0!=L.page.length&&(L.status=L.page.find(".order-status"),0!=L.status.length&&void(L.status.hasClass("os_closed")||L.status.hasClass("os_canceled")||(L.updateInterval=setInterval(L.onUpdateInterval,1e4))))},onUpdateInterval:function(){var n=["accepted","progress","ready","delivery","closed","canceled"];e.ajax("/cart/order/status",{cache:!1,dataType:"json",type:"POST",data:{guid:L.status.attr("data-guid"),xhr:v()},success:function(e){if(L.status.hasClass(e.status))return!1;for(var t in n)if(L.status.hasClass("os_"+n[t])){L.status.removeClass("os_"+n[t]);break}L.status.addClass("os_"+e.status),L.status.html(e.status_name),-1!==["closed","canceled"].indexOf(e.status)&&clearInterval(L.updateInterval)},error:function(e){l.debug&&console.log(e.responseJSON)}})}};return e(function(){e(window).on("resize",y),e("*[data-link]").on("click",function(){if(e(this).hasClass("selected")||e(this).hasClass("disabled")||e(this).hasClass("empty")||0==e(this).attr("data-link").length)return!1;window.location=e(this).attr("data-link")}),e(document).tooltip({track:!1,show:{duration:100}}),e("select.custom-select").each(function(){e(this).selectmenu().selectmenu("menuWidget").addClass("ui-widget-overflow").addClass("hidescroll")}),e(".switch-selector .ss_item.selected").each(function(){W.selectorPositioning(e(this))}),N.init(),j.init(),O.init(),B.init(),P.init(),T.init(),W.init()}),{varDump:function(e,n){return u(e,n)},profile:function(){I.init()},cart:function(){J.init(),z.init(),L.init()}}}});