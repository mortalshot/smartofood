document.addEventListener('DOMContentLoaded', function () {
    function ibg() {

    let ibg = document.querySelectorAll(".ibg");
    for (var i = 0; i < ibg.length; i++) {
        if (ibg[i].querySelector('img')) {
            ibg[i].style.backgroundImage = 'url(' + ibg[i].querySelector('img').getAttribute('src') + ')';
        }
    }
}

ibg();
let windowScrollTop = window.pageYOffset;
const homeTemplateHorisontal = document.querySelector('.home-template');
const header = document.querySelector('.header');

if (homeTemplateHorisontal) {
    const bodyNav = document.querySelector('.body_nav');

    if (windowScrollTop > 0) {
        bodyNav.classList.add('_scrolled');
        header.classList.add('_scrolled');
    }

    window.addEventListener('scroll', function () {
        let windowScrollTop = window.pageYOffset;

        if (windowScrollTop > 0) {
            bodyNav.classList.add('_scrolled');
            header.classList.add('_scrolled');
        } else {
            bodyNav.classList.remove('_scrolled');
            header.classList.remove('_scrolled');
        }
    })
}
document.addEventListener("click", documentActions);

function documentActions(e) {
    const targetElement = e.target;

    // HEADER_CITY ACTIONS START
    if (targetElement.classList.contains('header_city') || targetElement.closest('.header_city')) {
        document.querySelector('.header .header_city').classList.toggle('_active');
    } else if (!targetElement.closest('.header_city')) {
        document.querySelector('.header .header_city').classList.remove('_active');
    }
    // HEADER_CITY ACTIONS END

    // BURGER BUTTON ACTION START
    if (targetElement.classList.contains('header_hamburger') || targetElement.closest('.header_hamburger')) {
        document.querySelector('.header_hamburger').classList.toggle('_active');
        document.querySelector('#navigation').classList.toggle('opened'); //!need remove
    } else if (!targetElement.closest('.header_hamburger')) {
        document.querySelector('.header_hamburger').classList.remove('_active');
        document.querySelector('#navigation').classList.remove('opened'); //!need remove
    }
    // BURGER BUTTON ACTION END
}
const homeSlider = document.querySelectorAll('.home-slider');

if (homeSlider.length > 0) {
    mainBanners = new Swiper('.home-slider', {
        slidesPerView: 1,
        spaceBetween: 10,
        watchOverflow: true,
        autoHeight: false,
        preloadImages: false,
        
        lazy: {
            loadOnTransitionStart: true,
            loadPrevNext: true,
        },

        pagination: {
            el: '.home-slider .swiper-pagination',
            clickable: true,
        },

        navigation: {
            prevEl: '.home-slider .swiper__button-prev',
            nextEl: '.home-slider .swiper__button-next',
        },
    });

    const homeSlider = document.querySelectorAll('.home-slider');
    if (homeSlider.length > 0) {
        for (let index = 0; index < homeSlider.length; index++) {
            const element = homeSlider[index];
            const elementLength = element.querySelectorAll('.home-slider__item').length;

            if (elementLength <= 1) {
                element.classList.add('_without-controlls')
            }
        }
    }
};
const mediaQueryLgMax = window.matchMedia('(max-width: 991px)');
mediaQueryLgMax.addListener(handleTabletChangeLgMax);

function handleTabletChangeLgMax(e) {
    const bodyNav = document.querySelectorAll('.body_nav');
    const headerWrapper = document.querySelectorAll('.content-wrapper');

    if (e.matches) {
        // ===== HEADER OFFSET START =====
        if (headerWrapper.length > 0) {
            const headerWrapperHeight = headerWrapper[0].clientHeight;
            const headerWrapperDilator = document.querySelectorAll('.header_dilator');
            headerWrapperDilator[0].style.height = headerWrapperHeight + 'px';
        }

        if (bodyNav.length > 0) {
            const bodyNavHeight = bodyNav[0].clientHeight;
            const bodyNavDilator = document.querySelectorAll('.body_nav-dilator');
            bodyNavDilator[0].style.height = bodyNavHeight + 'px';
        }
        // ===== HEADER OFFSET END =====
    }

    else {
    }
}

handleTabletChangeLgMax(mediaQueryLgMax);
})