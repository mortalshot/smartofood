document.addEventListener('DOMContentLoaded', function () {
    function ibg() {

    let ibg = document.querySelectorAll(".ibg");
    for (var i = 0; i < ibg.length; i++) {
        if (ibg[i].querySelector('img')) {
            ibg[i].style.backgroundImage = 'url(' + ibg[i].querySelector('img').getAttribute('src') + ')';
        }
    }
}

ibg();
const hiddenBlock = document.querySelectorAll('.block-hidden');

if (hiddenBlock.length > 0) {
    for (let index = 0; index < hiddenBlock.length; index++) {
        const element = hiddenBlock[index];
        const link = element.querySelector('.block-hidden__link');
        const wrapper = element.querySelector('.block-hidden__wrapper');

        link.addEventListener('click', function(e) {
            e.preventDefault();

            element.classList.add("_show");
        })
    }
}
// ===== HEADER OFFSET START =====
const headerWrapper = document.querySelectorAll('.header .header_container');
let headerHeight = headerWrapper[0].clientHeight;
const headerWrapperDilator = document.querySelectorAll('.header_dilator');

const bodyNav = document.querySelectorAll('.body_nav');
let bodyNavHeight = bodyNav[0].clientHeight;
const bodyNavDilator = document.querySelectorAll('.body_nav-dilator');

let windowScrollTop = window.pageYOffset;

if (headerWrapper.length > 0) {
    setDilatorHeight(headerWrapper[0], headerHeight, headerWrapperDilator[0]);
}

if (bodyNav.length > 0) {
    setDilatorHeight(bodyNav[0], bodyNavHeight, bodyNavDilator[0]);
}

function setDilatorHeight(element, elementHeight, dilator) {
    element.style.height = elementHeight + 'px';
    dilator.style.height = elementHeight + 'px';
};

if (windowScrollTop > 0) {
    document.body.classList.add('_scrolled');
};
// ===== HEADER OFFSET END =====
document.addEventListener("click", documentActions);

function documentActions(e) {
    const targetElement = e.target;

    // HEADER_CITY ACTIONS START
    if (document.querySelector('.header .header_city')) {
        if (targetElement.classList.contains('header_city') || targetElement.closest('.header_city')) {
            document.querySelector('.header .header_city').classList.toggle('_active');
        } else if (!targetElement.closest('.header_city')) {
            document.querySelector('.header .header_city').classList.remove('_active');
        }
    }
    // HEADER_CITY ACTIONS END

    // BURGER BUTTON ACTION START
    if (document.querySelector('.header_hamburger')) {
        if (targetElement.classList.contains('header_hamburger') || targetElement.closest('.header_hamburger')) {
            document.querySelector('.header_hamburger').classList.toggle('_active');
            document.querySelector('#navigation').classList.toggle('opened'); //!need to remove
        }

        //!need to remove
        if (targetElement.classList.contains('close-block')  || targetElement.closest('.close-block')) {
            document.querySelector('.header_hamburger').classList.toggle('_active');
            document.querySelector('#navigation').classList.remove('opened'); //!need to remove
        }
    }
    // BURGER BUTTON ACTION END
}
const homeSlider = document.querySelectorAll('.home-slider');

if (homeSlider.length > 0) {
    mainBanners = new Swiper('.home-slider', {
        slidesPerView: 1,
        spaceBetween: 10,
        watchOverflow: true,
        autoHeight: false,
        preloadImages: false,

        lazy: {
            loadOnTransitionStart: true,
            loadPrevNext: true,
        },

        pagination: {
            el: '.home-slider .swiper-pagination',
            clickable: true,
        },

        navigation: {
            prevEl: '.home-slider .swiper__button-prev',
            nextEl: '.home-slider .swiper__button-next',
        },
    });

    for (let index = 0; index < homeSlider.length; index++) {
        const element = homeSlider[index];
        const elementLength = element.querySelectorAll('.home-slider__item').length;

        if (elementLength <= 1) {
            element.classList.add('_without-controlls')
        }
    }
};

const ingredients = document.querySelectorAll('.ingredients__slider');
if (ingredients.length > 0) {
    const ingredientsSlider = new Swiper('.ingredients__slider', {
        slidesPerView: 2,
        spaceBetween: 16,
        watchOverflow: true,
        autoHeight: false,
        preloadImages: false,

        lazy: {
            loadOnTransitionStart: true,
            loadPrevNext: true,
        },

        navigation: {
            prevEl: '.ingredients__slider .swiper__button-prev',
            nextEl: '.ingredients__slider .swiper__button-next',
        },

        breakpoints: {
            450: {
                slidesPerView: 3,
            },
            575: {
                slidesPerView: 4,
            },
            768: {
                slidesPerView: 5,
            },
        },

        on: {
            lock: function () {
                this.el.classList.add('_lock');
            },
        },
    });
}

const suggest = document.querySelectorAll('.load_suggest');
if (suggest.length > 0) {
    const suggestSlider = new Swiper('.load_suggest .swiper', {
        slidesPerView: 1,
        spaceBetween: 10,
        watchOverflow: true,
        autoHeight: false,
        preloadImages: false,

        lazy: {
            loadOnTransitionStart: true,
            loadPrevNext: true,
        },

        navigation: {
            prevEl: '.load_suggest .swiper__button-prev',
            nextEl: '.load_suggest .swiper__button-next',
        },

        breakpoints: {
            450: {
                slidesPerView: 2,
                spaceBetween: 16,
            },
            768: {
                slidesPerView: 3,
                spaceBetween: 16,
            },
            992: {
                slidesPerView: 4,
                spaceBetween: 20,
            },
            1250: {
                slidesPerView: 4,
                spaceBetween: 28,
            },
        },

        on: {
            lock: function () {
                this.el.classList.add('_lock');
            },
        },
    });
}
let elementWrapper = document.querySelector('.dropdown_list-wrapper');
let elementList = document.querySelector('.dropdown_list');
let shadowTop = elementWrapper.querySelector('.shadow--top');
let shadowBottom = elementWrapper.querySelector('.shadow--bottom');

let contentScrollHeight = elementList.scrollHeight - elementWrapper.offsetHeight;

if (contentScrollHeight <= 0) {
    shadowBottom.style.opacity = 0;
}

elementList.addEventListener('scroll', function (e) {
    let currentScroll = this.scrollTop / (contentScrollHeight);

    shadowTop.style.opacity = currentScroll;
    shadowBottom.style.opacity = 1 - currentScroll;
})


const mediaQueryLgMin = window.matchMedia('(min-width: 992px)');
mediaQueryLgMin.addListener(handleTabletChangeLgMax);

function handleTabletChangeLgMax(e) {
    if (e.matches) {
        window.addEventListener('scroll', function () {
            let windowScrollTop = window.pageYOffset;
        
            if (document.querySelector('.home-template').classList.contains('template2')) {
                if (windowScrollTop > 0) {
                    headerWrapper[0].style.height = headerHeight - 40 + "px";
                    headerWrapperDilator[0].style.height = headerHeight - 40 + "px";
        
                    bodyNav[0].style.top = headerHeight - 40 + "px";
                } else {
                    headerWrapper[0].style.height = headerHeight + "px";
                    headerWrapperDilator[0].style.height = headerHeight + "px";
        
                    bodyNav[0].style.top = headerHeight + "px";
                }
            }
        });
    }

    else {

    }
}

handleTabletChangeLgMax(mediaQueryLgMin);;

    const ingredientsButtons = document.querySelectorAll('.product_ingredients-btn');

    if (ingredientsButtons.length > 0) {
        for (let index = 0; index < ingredientsButtons.length; index++) {
            const element = ingredientsButtons[index];
            element.addEventListener('click', function () {
                document.querySelector('#mods-window').classList.add('opened');
            })
        }
    }
})